#!/bin/sh

# compile using ant
ant -f build.xml || exit


klist=(4)
nlist=(20)
llist=(50)
mlist=(30)
alist=(0.1)
blist=(0.01)

while getopts “k:n:l:m:a:b:” OPTION
do
    case $OPTION in
        k)
            klist=$OPTARG
            ;;
        n)
            nlist=$OPTARG
            ;;
        l)
            llist=$OPTARG
            ;;
        m)
            mlist=$OPTARG
            ;;
        a)
            alist=$OPTARG
            ;;
        b)
            blist=$OPTARG
            ;;
    esac
done

#Iterate through every combination of parameters
for k in "${klist[@]}";
do
    for n in "${nlist[@]}";
    do
        for l in "${llist[@]}";
        do
            for m in "${mlist[@]}";
            do
                for a in "${alist[@]}";
                do
                    for b in "${blist[@]}";
                    do
                        #Generate a data file with given parameters
                        cd src/datageneration/
                        python documents.py -w -k $k -n $n -l $l -m $m -a $a \
                        -b $b
                        cd output/k$k.n$n.l$l.m$m.a$a.b$b
                        cp documents-out ../../../../data/
                        cd ../../../../

                        #Make a JSON out of the generated data
                        java -classpath bin:lib/jars/json.jar datageneration/MakeJSON documents-out false

                        #Run the test
                        ./test data/documents-out.json
                    done
                done
            done
        done
    done
done
